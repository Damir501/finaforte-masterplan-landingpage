<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Box 3 Optimizer Calculator | Finaforte</title>
  <meta name="description" content="Bereken je Box 3 belasting en ontdek optimalisatiemogelijkheden voor je vermogensstructuur.">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #fafafa; min-height: 100vh; }
    .container { max-width: 900px; margin: 0 auto; padding: 24px; }
    .header { background: linear-gradient(135deg, #1AABA6 0%, #158783 100%); border-radius: 16px; padding: 32px; margin-bottom: 24px; color: white; }
    .header-tag { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; margin-bottom: 8px; }
    .header h1 { font-size: 26px; font-weight: 700; margin-bottom: 8px; }
    .header p { font-size: 16px; opacity: 0.9; }
    .card { background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    .card h3 { font-size: 16px; color: #333; margin-bottom: 16px; border-bottom: 2px solid #1AABA6; padding-bottom: 8px; }
    .input-group { margin-bottom: 16px; }
    .input-label { display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px; }
    .input-hint { font-size: 12px; color: #666; margin-top: 4px; }
    .input-field { width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 16px; }
    .input-field:focus { outline: none; border-color: #1AABA6; }
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .btn { width: 100%; padding: 16px; background: #1AABA6; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
    .btn:hover { background: #158783; }
    .btn:disabled { background: #ccc; cursor: not-allowed; }
    .result-card { background: linear-gradient(135deg, #1AABA6 0%, #158783 100%); border-radius: 12px; padding: 24px; margin-bottom: 24px; color: white; }
    .result-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 20px; margin-top: 16px; }
    .stat-label { font-size: 12px; opacity: 0.8; }
    .stat-value { font-size: 24px; font-weight: 700; }
    .breakdown { margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.2); }
    .breakdown-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
    .tip-card { background: #fffbeb; border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; margin-bottom: 16px; }
    .tip-card h4 { color: #b45309; margin-bottom: 8px; font-size: 14px; }
    .tip-card p { color: #92400e; font-size: 13px; line-height: 1.5; }
    .toggle-group { display: flex; gap: 8px; }
    .toggle-btn { flex: 1; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; background: white; cursor: pointer; font-size: 14px; }
    .toggle-btn.active { border-color: #1AABA6; background: #f0faf9; color: #1AABA6; font-weight: 600; }
    .cta-card { text-align: center; border: 2px solid #1AABA6; padding: 32px; }
    .form-input { width: 100%; padding: 14px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 16px; margin-bottom: 12px; }
    .form-input:focus { outline: none; border-color: #1AABA6; }
    .form-hint { font-size: 12px; color: #999; margin-top: 12px; text-align: center; }
    .success-card { background: #f0faf9; text-align: center; border: 2px solid #1AABA6; padding: 32px; }
    .disclaimer { font-size: 11px; color: #999; text-align: center; margin-top: 24px; line-height: 1.5; }
    .info-box { background: #f0faf9; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 13px; color: #158783; }
    .error-msg { color: #c53030; font-size: 14px; margin-bottom: 12px; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-right: 8px; vertical-align: middle; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 600px) { .input-row { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
        
    // ============================================
    // FINAFORTE LEAD CAPTURE CONFIGURATIE
    // ============================================
    const LEAD_CONFIG = {
      emailTo: 'd.tvrtkovic@finaforte.nl',
      calculatorName: 'Box 3 Optimizer'
    };
    // ============================================
// ============================================

    // Box 3 parameters 2026
    const PARAMS = {
      heffingvrijAlleen: 57684,
      heffingvrijPartner: 115368,
      forfaitSparen: 0.0103,
      forfaitBeleggen: 0.0588,
      forfaitSchuld: 0.0247,
      tarief: 0.36,
      schuldendrempelAlleen: 3700,
      schuldendrempelPartner: 7400,
    };

    // UTM parameters ophalen
    const getUTMParams = () => {
      const params = new URLSearchParams(window.location.search);
      return {
        utm_source: params.get('utm_source') || '',
        utm_medium: params.get('utm_medium') || '',
        utm_campaign: params.get('utm_campaign') || '',
        utm_content: params.get('utm_content') || '',
        utm_term: params.get('utm_term') || '',
      };
    };

    const formatCurrency = (n) => new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(n);

    function App() {
      const [spaargeld, setSpaargeld] = React.useState(100000);
      const [beleggingen, setBeleggingen] = React.useState(200000);
      const [crypto, setCrypto] = React.useState(50000);
      const [vastgoed, setVastgoed] = React.useState(0);
      const [schulden, setSchulden] = React.useState(0);
      const [partner, setPartner] = React.useState(true);
      const [showResults, setShowResults] = React.useState(false);
      const [showLeadForm, setShowLeadForm] = React.useState(false);
      const [email, setEmail] = React.useState('');
      const [naam, setNaam] = React.useState('');
      const [submitted, setSubmitted] = React.useState(false);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState('');

      const result = React.useMemo(() => {
        const totaalBezit = spaargeld + beleggingen + crypto + vastgoed;
        const heffingvrij = partner ? PARAMS.heffingvrijPartner : PARAMS.heffingvrijAlleen;
        const schuldendrempel = partner ? PARAMS.schuldendrempelPartner : PARAMS.schuldendrempelAlleen;
        const aftrekbareSchulden = Math.max(0, schulden - schuldendrempel);
        const nettoVermogen = totaalBezit - aftrekbareSchulden;
        const grondslag = Math.max(0, nettoVermogen - heffingvrij);

        const forfaitSparen = spaargeld * PARAMS.forfaitSparen;
        const forfaitOverig = (beleggingen + crypto + vastgoed) * PARAMS.forfaitBeleggen;
        const forfaitSchuld = aftrekbareSchulden * PARAMS.forfaitSchuld;
        const totaalForfait = forfaitSparen + forfaitOverig - forfaitSchuld;

        const effectiefForfait = totaalBezit > 0 ? totaalForfait / totaalBezit : 0;
        const belastbaarInkomen = grondslag > 0 ? grondslag * effectiefForfait : 0;
        const belasting = belastbaarInkomen * PARAMS.tarief;
        const effectiefTarief = nettoVermogen > 0 ? (belasting / nettoVermogen) * 100 : 0;

        const tips = [];
        if (beleggingen > 50000) {
          tips.push({ title: 'ðŸ’¡ Inbreng in BV overwegen', text: `Met â‚¬${beleggingen.toLocaleString('nl-NL')} aan beleggingen kun je overwegen om (een deel) in te brengen in je BV via agio. Je verlaagt hiermee je Box 3 grondslag en betaalt VPB (19-25,8%) i.p.v. Box 3 (effectief tot 2,16%).` });
        }
        if (spaargeld > 100000 && !partner) {
          tips.push({ title: 'ðŸ’‘ Fiscaal partnerschap', text: `Met een fiscaal partner verdubbelt je heffingvrij vermogen naar ${formatCurrency(PARAMS.heffingvrijPartner)}. Dit bespaart direct belasting.` });
        }
        if (schulden < 100000 && nettoVermogen > heffingvrij) {
          tips.push({ title: 'ðŸ¦ Lenen van BV', text: `Als DGA kun je tot â‚¬500.000 lenen van je BV (excessief lenen grens). Deze schuld verlaagt je Box 3 grondslag, let wel op de schuldendrempel van ${formatCurrency(schuldendrempel)}.` });
        }
        if (grondslag > 0 && spaargeld > 50000) {
          tips.push({ title: 'ðŸ“Š Peildatum optimalisatie', text: 'Box 3 wordt bepaald op peildatum 1 januari. Overweeg strategische timing van grote uitgaven of investeringen rond de jaarwisseling.' });
        }

        return { totaalBezit, nettoVermogen, heffingvrij, grondslag, belasting, effectiefTarief, forfaitSparen, forfaitOverig, tips, aftrekbareSchulden, schuldendrempel, nietAftrekbareSchulden: Math.min(schulden, schuldendrempel) };
      }, [spaargeld, beleggingen, crypto, vastgoed, schulden, partner]);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        const utmParams = getUTMParams();

        const formData = new FormData();
        formData.append('email', email);
        formData.append('naam', naam);
        formData.append('timestamp', new Date().toISOString());
        // Invoer
        formData.append('spaargeld', spaargeld);
        formData.append('beleggingen', beleggingen);
        formData.append('crypto', crypto);
        formData.append('vastgoed', vastgoed);
        formData.append('schulden', schulden);
        formData.append('fiscaal_partner', partner ? 'Ja' : 'Nee');
        // Resultaten
        formData.append('totaal_bezittingen', result.totaalBezit);
        formData.append('netto_vermogen', result.nettoVermogen);
        formData.append('heffingvrij_vermogen', result.heffingvrij);
        formData.append('grondslag', result.grondslag);
        formData.append('box3_belasting', Math.round(result.belasting));
        formData.append('effectief_tarief', result.effectiefTarief.toFixed(2));
        formData.append('aantal_tips', result.tips.length);
        // UTM
        formData.append('utm_source', utmParams.utm_source);
        formData.append('utm_medium', utmParams.utm_medium);
        formData.append('utm_campaign', utmParams.utm_campaign);
        formData.append('utm_content', utmParams.utm_content);
        formData.append('utm_term', utmParams.utm_term);
        formData.append('bron', 'Box 3 Optimizer Calculator');
        formData.append('pagina_url', window.location.href);

        try {
          const response = await fetch(`https://formsubmit.co/ajax/${LEAD_CONFIG.emailTo}`, {
            method: 'POST',
            body: formData,
          });
          if (response.ok) {
            setSubmitted(true);
          } else {
            setError('Er ging iets mis. Probeer het opnieuw.');
          }
        } catch (err) {
          setError('Er ging iets mis. Probeer het opnieuw.');
        }
        setLoading(false);
      };

      const resetForm = () => {
        setShowResults(false);
        setShowLeadForm(false);
        setSubmitted(false);
        setEmail('');
        setNaam('');
        setError('');
      };

      return (
        <div className="container">
          <div className="header">
            <div className="header-tag">Gratis Calculator 2026</div>
            <h1>Box 3 Optimizer</h1>
            <p>Bereken je vermogensbelasting en ontdek hoe je kunt optimaliseren</p>
          </div>

          <div className="card">
            <h3>ðŸ’° Bezittingen</h3>
            <div className="info-box">Vul de waarde per 1 januari 2026 (peildatum) in.</div>
            <div className="input-row">
              <div className="input-group">
                <label className="input-label">Spaargeld (1,03% forfait)</label>
                <input type="number" className="input-field" value={spaargeld} onChange={e => setSpaargeld(+e.target.value)} />
                <div className="input-hint">Bank- en spaarrekeningen</div>
              </div>
              <div className="input-group">
                <label className="input-label">Beleggingen (5,88% forfait)</label>
                <input type="number" className="input-field" value={beleggingen} onChange={e => setBeleggingen(+e.target.value)} />
                <div className="input-hint">Aandelen, fondsen, ETF's, obligaties</div>
              </div>
            </div>
            <div className="input-row">
              <div className="input-group">
                <label className="input-label">Crypto (5,88% forfait)</label>
                <input type="number" className="input-field" value={crypto} onChange={e => setCrypto(+e.target.value)} />
                <div className="input-hint">Bitcoin, Ethereum, etc.</div>
              </div>
              <div className="input-group">
                <label className="input-label">Vastgoed Box 3 (5,88% forfait)</label>
                <input type="number" className="input-field" value={vastgoed} onChange={e => setVastgoed(+e.target.value)} />
                <div className="input-hint">WOZ-waarde 2e woning, verhuurpand</div>
              </div>
            </div>
          </div>

          <div className="card">
            <h3>ðŸ“‰ Schulden & Situatie</h3>
            <div className="input-group">
              <label className="input-label">Schulden (2,47% aftrek)</label>
              <input type="number" className="input-field" value={schulden} onChange={e => setSchulden(+e.target.value)} />
              <div className="input-hint">Let op: drempel van {formatCurrency(partner ? PARAMS.schuldendrempelPartner : PARAMS.schuldendrempelAlleen)} is niet aftrekbaar</div>
            </div>
            <div className="input-group">
              <label className="input-label">Fiscaal partner?</label>
              <div className="toggle-group">
                <button className={`toggle-btn ${partner ? 'active' : ''}`} onClick={() => setPartner(true)}>Ja ({formatCurrency(PARAMS.heffingvrijPartner)} vrij)</button>
                <button className={`toggle-btn ${!partner ? 'active' : ''}`} onClick={() => setPartner(false)}>Nee ({formatCurrency(PARAMS.heffingvrijAlleen)} vrij)</button>
              </div>
            </div>
          </div>

          <button className="btn" onClick={() => setShowResults(true)}>Bereken Box 3 belasting â†’</button>

          {showResults && (
            <>
              <div className="result-card" style={{marginTop: 24}}>
                <div style={{fontSize: 12, textTransform: 'uppercase', opacity: 0.8}}>Je Box 3 belasting 2026</div>
                <div style={{fontSize: 36, fontWeight: 700, margin: '8px 0'}}>{formatCurrency(result.belasting)}</div>
                <div style={{fontSize: 14, opacity: 0.9}}>per jaar â€¢ effectief tarief: {result.effectiefTarief.toFixed(2)}%</div>

                <div className="breakdown">
                  <div className="breakdown-row"><span>Totaal bezittingen</span><span>{formatCurrency(result.totaalBezit)}</span></div>
                  <div className="breakdown-row"><span>Schulden</span><span>- {formatCurrency(schulden)}</span></div>
                  {result.nietAftrekbareSchulden > 0 && (
                    <div className="breakdown-row" style={{opacity: 0.7, fontSize: 12}}><span>â†³ Waarvan niet aftrekbaar (drempel)</span><span>{formatCurrency(result.nietAftrekbareSchulden)}</span></div>
                  )}
                  <div className="breakdown-row"><span>Rendementsgrondslag</span><span>{formatCurrency(result.nettoVermogen)}</span></div>
                  <div className="breakdown-row"><span>Heffingvrij vermogen</span><span>- {formatCurrency(result.heffingvrij)}</span></div>
                  <div className="breakdown-row" style={{fontWeight: 600, borderTop: '1px solid rgba(255,255,255,0.3)', paddingTop: 8}}><span>Grondslag sparen en beleggen</span><span>{formatCurrency(result.grondslag)}</span></div>
                </div>
              </div>

              {result.tips.length > 0 && (
                <div className="card">
                  <h3>ðŸŽ¯ Optimalisatie Tips</h3>
                  {result.tips.map((tip, i) => (
                    <div key={i} className="tip-card">
                      <h4>{tip.title}</h4>
                      <p>{tip.text}</p>
                    </div>
                  ))}
                </div>
              )}

              {!showLeadForm && !submitted && (
                <div className="card cta-card">
                  <div style={{fontSize: 32, marginBottom: 8}}>ðŸ“Š</div>
                  <h3 style={{fontSize: 20, color: '#333', marginBottom: 8, border: 'none'}}>Wil je een persoonlijk optimalisatieplan?</h3>
                  <p style={{color: '#666', marginBottom: 20}}>Ontvang een uitgebreid rapport met concrete stappen om je Box 3 belasting te minimaliseren</p>
                  <button className="btn" style={{width: 'auto', padding: '14px 32px'}} onClick={() => setShowLeadForm(true)}>Ontvang gratis rapport â†’</button>
                </div>
              )}

              {showLeadForm && !submitted && (
                <div className="card cta-card" style={{textAlign: 'left'}}>
                  <h3 style={{fontSize: 20, color: '#333', marginBottom: 16, border: 'none'}}>Waar mogen we je rapport naartoe sturen?</h3>
                  <form onSubmit={handleSubmit}>
                    <input type="text" className="form-input" placeholder="Je naam" value={naam} onChange={e => setNaam(e.target.value)} required />
                    <input type="email" className="form-input" placeholder="je@email.nl" value={email} onChange={e => setEmail(e.target.value)} required />
                    {error && <p className="error-msg">{error}</p>}
                    <button type="submit" className="btn" disabled={loading}>
                      {loading ? <><span className="loading"></span>Versturen...</> : 'Verstuur mijn rapport â†’'}
                    </button>
                  </form>
                  <p className="form-hint">We respecteren je privacy. Geen spam, alleen waardevolle inzichten.</p>
                </div>
              )}

              {submitted && (
                <div className="card success-card">
                  <div style={{fontSize: 48, marginBottom: 16}}>âœ…</div>
                  <h3 style={{fontSize: 20, color: '#1AABA6', marginBottom: 8, border: 'none'}}>Je rapport is onderweg!</h3>
                  <p style={{color: '#666', marginBottom: 16}}>Check je inbox voor je persoonlijke Box 3 optimalisatieplan.</p>
                  <button className="btn" style={{width: 'auto', padding: '12px 24px', background: 'transparent', color: '#1AABA6', border: '2px solid #1AABA6'}} onClick={resetForm}>
                    Nieuwe berekening maken
                  </button>
                </div>
              )}

              <p className="disclaimer">
                Deze berekening is indicatief en gebaseerd op fiscale parameters 2026.
                Forfait spaargeld (1,03%) en schulden (2,47%) zijn voorlopig en worden na afloop van 2026 definitief vastgesteld.
                Forfait beleggen: 5,88%. Tarief: 36%. Heffingsvrij: {formatCurrency(PARAMS.heffingvrijAlleen)} (alleen) / {formatCurrency(PARAMS.heffingvrijPartner)} (partners).
                <br/>Â© 2026 Finaforte Financial Planning | www.finaforte.nl
              </p>
            </>
          )}
        </div>
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
